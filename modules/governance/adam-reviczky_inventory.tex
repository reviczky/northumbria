% engine=luajittex

\setuppapersize[A3,landscape][A3,landscape]

\setuplayout
    [
        backspace=10mm,
        width=400mm,
        topspace=10mm,
        header=10mm,
        footer=10mm,
        height=277mm
    ]

\setuppagenumbering[location=footer]
\setupbodyfont[heros,10pt]

\showframe

\starttext

\starttitle[title={Information Asset Inventory}]

\startxtable
\startluacode
local mycsvsplitter = utilities.parsers.csvsplitter{
     separator = ",",
     quote = '"',
}

local crap = io.loaddata("inventory.csv")

local tablerows = mycsvsplitter(crap)

context.startxtablehead()
context.startxcellgroup({background="color",backgroundcolor="darkgray",foregroundcolor="white"})
context.startxrow()
context.startxcell() context.stopxcell()
context.startxcell({nx=3}) context("Organisation & relevant process") context.stopxcell()
context.startxcell({nx=11}) context("Information Asset Details") context.stopxcell()
context.startxcell({nx=2}) context("Current Level of Protection") context.stopxcell()
context.stopxrow()
context.stopxcellgroup()
context.startxcellgroup({background="color",backgroundcolor="lightgray"})
for i=1,1 do
    context.startxrow()
    local l = tablerows[i]
    for j=1,#l do
        context.startxcell()
        context(l[j])
        context.stopxcell()
    end
    context.stopxrow()
end
context.stopxcellgroup()
context.stopxtablehead()

context.startxtablebody()
for i=2,#tablerows do
    context.startxrow()
    local l = tablerows[i]
    for j=1,#l do
        context.startxcell()
        context(l[j])
        context.stopxcell()
    end
    context.stopxrow()
end
context.stopxtablebody()
\stopluacode
\stopxtable

\stoptitle
\stoptext
