% engine=luajittex

\setuppapersize[A4,portrait][A4,portrait]

\setuplayout
    [
        backspace=10mm,
        cutspace=10mm,
        width=190mm,
        topspace=10mm,
        header=10mm,
        footer=10mm,
        height=277mm,
    ]

\define\studentname{Adam Reviczky}
\define\studentnumber{14044980}
\define\modulename{Information Governance and Security}
\define\documentname{Report}

\startsetups[headertext]
    \startframed[frame=off,align=middle,width=fit]\bf\WORD
        Student Name: {\studentname} {\|} Student Number: {\studentnumber} \\
        Module: {\modulename} ({\documentname})
    \stopframed
\stopsetups

\setupheadertexts[\directsetup{headertext}]

\setuphead[section][style=\bfb]

\usemodule[filter]

\defineexternalfilter
    [pandoc]
    [
        filter={pandoc --no-wrap
            -f \externalfilterparameter{format} -t context
            -o \externalfilteroutputfile},
        format=markdown,
    ]

\setuppagenumbering[location=footer,left={\endash\ },right={\ \endash}]
\setupbodyfont[pagella,10pt]

\placebookmarks[chapter,section,subsection][chapter,section]
\setupinteractionscreen[option=bookmark]

\setupinteraction
    [
        state=start,
        title={Information Governance and Security},
        author={Adam Reviczky},
        subtitle={Report},
        keyword={northumbria},
    ]

\setupspellchecking[state=start,method=2]
\ctxlua{languages.words.threshold=1}

\setupbibtex[database={report},sort=author]

\showframe

\starttext
    \startstandardmakeup
    \startalignment[middle]
        \switchtobodyfont[adventor,12pt] \tfd
        \blank[25mm]
        \WORD{Module 1 \blank[2*line] Information Governance \\ and \\ Security} \\
        \blank[2*line]
        {\bf\documentname} \\
        \blank[90mm]
        {\startcolor[darkblue] \tfc \studentname \\ (\studentnumber) \stopcolor} \\
        \blank[35mm]
        {\startcolor[black] \bfb MSc in Cyber Security 2015/2016 \stopcolor}
    \stopalignment
    \stopstandardmakeup

    \page

    \processpandocfile{report.md}

    \page \strut
    \startalignment[middle]
    \startcolor[black] \tfx
        \blank[line]
        \midaligned{\startMPcode \input northumbria \stopMPcode}
        \blank[line]
        University of Northumbria at Newcastle. \\
        \blank[line]
        International House, 1 St Katharines Way, London E1W 1UN \\
        United Kingdom \\
        \blank[2*line]
        Â© 2015 Adam Reviczky \\
        All rights are reserved. \\
        \blank[2*line]
        Typesetted in Great Britain by \\
        \ConTeXt\ version \contextversion \\
        \texenginename\ version \texengineversion \\
        \blank[2*line] \vfill
        Total number of words (with a theshold of 1 character): {\bf \ctxlua{local data = dofile"\jobname.words"; context(data.total)}} \\
        Maximum number of words allowed: {\bf 2,500} \\
        Bibliography: {\bf American Psychological Association (APA) style} \\
        Paper Size: {\bf A4, Portrait} \\
        Font Family: {\bf TeX Gyre Pagella, 10pt} \\
        Margins: Backspace ({\bf \startluacode local layout = tex.dimen.backspace context("%s mm", number.tomillimeters(layout, "%.0f")) \stopluacode}), Cutspace ({\bf \startluacode local layout = tex.dimen.cutspace context("%s mm", number.tomillimeters(layout, "%.0f")) \stopluacode}), Topspace ({\bf \startluacode local layout = tex.dimen.topspace context("%s mm", number.tomillimeters(layout, "%.0f")) \stopluacode}), Header ({\bf \startluacode local layout = tex.dimen.headerheight context("%s mm", number.tomillimeters(layout, "%.0f")) \stopluacode}), Footer ({\bf \startluacode local layout = tex.dimen.footerheight context("%s mm", number.tomillimeters(layout, "%.0f")) \stopluacode}) \\
        \blank[2*line]
    \stopcolor
    \stopalignment
\stoptext
